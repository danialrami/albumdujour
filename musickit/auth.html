<!DOCTYPE html>
<html>
<head>
    <title>Apple Music Authorization</title>
    <script src="https://js-cdn.music.apple.com/musickit/v1/musickit.js"></script>
</head>
<body>
    <button onclick="authorize()">Authorize Apple Music</button>
    <script>
        let musicKitInstance = null;

        document.addEventListener('musickitloaded', () => {
            console.log('MusicKit loaded');
            try {
                musicKitInstance = MusicKit.configure({
                    developerToken: 'eyJhbGciOiJFUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6Ik5aUFNOTU05RDgifQ.eyJpYXQiOjE3MzYxOTkzMjUsImV4cCI6MTc1MTc1MTMyNSwiaXNzIjoiSDRONlFYV1pXOSJ9.jeYolHMZVm_RhrQ6b0jeDJcRawcNIZ3u3HsDAQ6voardWgOGps1dUuVvrxpwpp6akYYJDJjMBwj03yD2GaLa4g',
                    app: {
                        name: 'My Music App',
                        build: '1.0'
                    }
                });
                console.log('MusicKit configured');
            } catch (error) {
                console.error('Configuration error:', error);
            }
        });

        async function authorize() {
            try {
                console.log('Authorization started');
                if (!musicKitInstance) {
                    console.error('MusicKit not initialized');
                    return;
                }
                const musicUserToken = await musicKitInstance.authorize();
                console.log('Music User Token:', musicUserToken);
                
                await fetch('http://localhost:3000/save-token', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ token: musicUserToken })
                });
                alert('Token saved successfully!');
            } catch (error) {
                console.error('Authorization error:', error);
            }
        }
    </script>
</body>
</html>
